<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>World Clock + Map Preview</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet/dist/leaflet.css" />
<style>
    /* ---------- RED & BLACK THEME ---------- */
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
    }
    header {
        text-align: center;
        padding: 20px;
        background: #1a1a1a;
        font-size: 24px;
        font-weight: bold;
        color: #ff0000;
    }
    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
    }
    .search-container {
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
        width: 300px;
    }
    input[type=text] {
        padding: 10px;
        font-size: 16px;
        border: none;
        border-radius: 5px 5px 0 0;
        outline: none;
    }
    ul.suggestions {
        list-style: none;
        padding: 0;
        margin: 0;
        max-height: 150px;
        overflow-y: auto;
        background: #222;
        border-radius: 0 0 5px 5px;
    }
    ul.suggestions li {
        padding: 10px;
        cursor: pointer;
        border-bottom: 1px solid #333;
    }
    ul.suggestions li:hover {
        background: #333;
    }
    button {
        margin-top: 10px;
        padding: 10px;
        border: none;
        border-radius: 5px;
        background: #ff0000;
        color: #fff;
        font-size: 16px;
        cursor: pointer;
    }
    .clocks {
        display: flex;
        justify-content: center;
        gap: 50px;
        margin-bottom: 20px;
    }
    .clock {
        text-align: center;
    }
    .clock h3 {
        margin: 5px 0;
        color: #ff0000;
    }
    #map {
        width: 90%;
        max-width: 800px;
        height: 400px;
        border: 2px solid #ff0000;
        border-radius: 10px;
    }
    .loading-screen {
        position: fixed;
        top:0;
        left:0;
        width:100%;
        height:100%;
        background:#111;
        display:flex;
        justify-content:center;
        align-items:center;
        z-index: 9999;
    }
    .spinner {
        border: 5px solid #222;
        border-top: 5px solid #ff0000;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% {transform: rotate(0deg);}
        100% {transform: rotate(360deg);}
    }
</style>
</head>
<body>
<div class="loading-screen" id="loading">
    <div class="spinner"></div>
</div>

<header>World Clock + Map Preview</header>
<div class="container">

    <!-- SEARCH & AUTOCOMPLETE -->
    <div class="search-container">
        <input type="text" id="cityInput" placeholder="Enter city name...">
        <ul class="suggestions" id="suggestions"></ul>
        <button id="useLocationBtn">Use My Location</button>
    </div>

    <!-- CLOCKS -->
    <div class="clocks">
        <div class="clock">
            <h3 id="clock1Name">Clock 1</h3>
            <p id="clock1Time">--:--:--</p>
        </div>
        <div class="clock">
            <h3 id="clock2Name">Clock 2</h3>
            <p id="clock2Time">--:--:--</p>
        </div>
    </div>

    <!-- MAP -->
    <div id="map"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/leaflet/dist/leaflet.js"></script>
<script>
    // ---------- LOADING SCREEN ----------
    window.addEventListener('load', () => {
        setTimeout(() => {
            document.getElementById('loading').style.display = 'none';
        }, 800);
    });

    // ---------- MAP ----------
    let map = L.map('map').setView([41.8781, -87.6298], 5); // default Chicago
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    let markers = [];

    function addMarker(lat, lon, name) {
        let marker = L.marker([lat, lon]).addTo(map).bindPopup(name).openPopup();
        markers.push(marker);
        map.setView([lat, lon], 10);
    }

    function clearMarkers() {
        markers.forEach(marker => map.removeLayer(marker));
        markers = [];
    }

    // ---------- AUTOCOMPLETE ----------
    const apiKey = "YOUR_GEOAPIFY_API_KEY"; // Replace with your Geoapify API key
    const input = document.getElementById("cityInput");
    const suggestionsList = document.getElementById("suggestions");

    input.addEventListener("input", async () => {
        const value = input.value;
        if (!value) {
            suggestionsList.innerHTML = "";
            return;
        }

        const res = await fetch(`https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(value)}&type=city&apiKey=${apiKey}`);
        const data = await res.json();
        suggestionsList.innerHTML = "";
        data.features.forEach(f => {
            const city = f.properties.city || f.properties.county || f.properties.state;
            const state = f.properties.state || "";
            const country = f.properties.country || "";
            const li = document.createElement("li");
            li.textContent = `${city}, ${state}, ${country}`;
            li.dataset.lat = f.properties.lat;
            li.dataset.lon = f.properties.lon;
            li.dataset.name = li.textContent;
            li.addEventListener("click", () => selectCity(li));
            suggestionsList.appendChild(li);
        });
    });

    function selectCity(li) {
        const lat = li.dataset.lat;
        const lon = li.dataset.lon;
        const name = li.dataset.name;
        clearMarkers();
        addMarker(lat, lon, name);

        // Update Clock 1 if empty, else Clock 2
        if (!document.getElementById("clock1Time").dataset.set) {
            document.getElementById("clock1Name").textContent = name;
            document.getElementById("clock1Time").dataset.lat = lat;
            document.getElementById("clock1Time").dataset.lon = lon;
            document.getElementById("clock1Time").dataset.set = true;
        } else {
            document.getElementById("clock2Name").textContent = name;
            document.getElementById("clock2Time").dataset.lat = lat;
            document.getElementById("clock2Time").dataset.lon = lon;
            document.getElementById("clock2Time").dataset.set = true;
        }
        suggestionsList.innerHTML = "";
        input.value = "";
    }

    // ---------- USE MY LOCATION ----------
    document.getElementById("useLocationBtn").addEventListener("click", () => {
        navigator.geolocation.getCurrentPosition(async (position) => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const res = await fetch(`https://api.geoapify.com/v1/geocode/reverse?lat=${lat}&lon=${lon}&apiKey=${apiKey}`);
            const data = await res.json();
            const f = data.features[0];
            const city = f.properties.city || f.properties.county || f.properties.state;
            const state = f.properties.state || "";
            const country = f.properties.country || "";
            const name = `${city}, ${state}, ${country}`;
            clearMarkers();
            addMarker(lat, lon, name);

            // Update Clock 1 if empty, else Clock 2
            if (!document.getElementById("clock1Time").dataset.set) {
                document.getElementById("clock1Name").textContent = name;
                document.getElementById("clock1Time").dataset.lat = lat;
                document.getElementById("clock1Time").dataset.lon = lon;
                document.getElementById("clock1Time").dataset.set = true;
            } else {
                document.getElementById("clock2Name").textContent = name;
                document.getElementById("clock2Time").dataset.lat = lat;
                document.getElementById("clock2Time").dataset.lon = lon;
                document.getElementById("clock2Time").dataset.set = true;
            }
        });
    });

    // ---------- CLOCK UPDATES ----------
    function updateClocks() {
        ["clock1Time", "clock2Time"].forEach(id => {
            const elem = document.getElementById(id);
            if (elem.dataset.lat && elem.dataset.lon) {
                const date = new Date();
                // Approximate local time using timezone offset from longitude
                const offset = elem.dataset.lon / 15; // 360deg / 24 hours = 15 deg per hour
                let hours = date.getUTCHours() + offset;
                if (hours < 0) hours += 24;
                if (hours >= 24) hours -= 24;
                const minutes = date.getUTCMinutes();
                const seconds = date.getUTCSeconds();
                elem.textContent = `${Math.floor(hours).toString().padStart(2,"0")}:${minutes.toString().padStart(2,"0")}:${seconds.toString().padStart(2,"0")}`;
            }
        });
    }
    setInterval(updateClocks, 1000);
</script>
</body>
</html>
